<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Gh√©p ·∫¢nh V√†o Khung</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; }
    canvas { border: 1px solid #ccc; margin-top: 10px; display: block; margin-left: auto; margin-right: auto; }
    .controls { margin: 10px; }
    button { margin: 5px; padding: 8px 12px; }
  </style>
</head>
<body>
  <h2>Gh√©p ·∫¢nh V√†o Khung</h2>
  
  <div class="controls">
    <input type="file" id="upload" accept="image/*">
    <button id="apply">G·∫Øn v√†o khung</button>
    <button id="download">Download</button>
  </div>

  <div class="controls">
    <button id="up">‚¨Ü</button><br>
    <button id="left">‚¨Ö</button>
    <button id="down">‚¨á</button>
    <button id="right">‚û°</button>
  </div>

  <div class="controls">
    <button id="zoomIn">üîç +</button>
    <button id="zoomOut">üîç -</button>
  </div>

  <canvas id="canvas"></canvas>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    let frame = new Image();
    frame.src = "frame.png"; // file PNG khung (n·ªÅn ƒë·ªè + l·ªó tr·ªëng trong su·ªët)

    let userImg = null;
    let userX = 0, userY = 0;
    let userScale = 1;

    // Khi khung load xong th√¨ set k√≠ch th∆∞·ªõc canvas = khung
    frame.onload = () => {
      canvas.width = frame.width;
      canvas.height = frame.height;
      redraw();
    };

    // V·∫Ω l·∫°i canvas
    function redraw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (userImg) {
        ctx.drawImage(userImg, userX, userY, userImg.width * userScale, userImg.height * userScale);
      }
      ctx.drawImage(frame, 0, 0, canvas.width, canvas.height); // khung lu√¥n tr√™n c√πng
    }

    // Upload ·∫£nh
    let uploadedFile = null;
    document.getElementById("upload").addEventListener("change", (e) => {
      uploadedFile = e.target.files[0];
    });

    // N√∫t "G·∫Øn v√†o khung"
    document.getElementById("apply").addEventListener("click", () => {
      if (!uploadedFile) return alert("H√£y ch·ªçn ·∫£nh tr∆∞·ªõc!");
      const reader = new FileReader();
      reader.onload = (ev) => {
        userImg = new Image();
        userImg.onload = () => {
          userX = (canvas.width - userImg.width) / 2;
          userY = (canvas.height - userImg.height) / 2;
          userScale = 1;
          redraw();
        };
        userImg.src = ev.target.result;
      };
      reader.readAsDataURL(uploadedFile);
    });

    // ƒêi·ªÅu khi·ªÉn b·∫±ng ph√≠m m≈©i t√™n v√† + -
    document.addEventListener("keydown", (e) => {
      if (!userImg) return;
      let moved = false;
      switch (e.key) {
        case "ArrowUp": userY -= 5; moved = true; break;
        case "ArrowDown": userY += 5; moved = true; break;
        case "ArrowLeft": userX -= 5; moved = true; break;
        case "ArrowRight": userX += 5; moved = true; break;
        case "+": 
        case "=": 
        case "Add": userScale *= 1.05; moved = true; break;
        case "-": 
        case "_": 
        case "Subtract": userScale /= 1.05; moved = true; break;
      }
      if (moved) {
        e.preventDefault(); // ch·∫∑n scroll trang
        redraw();
      }
    });

    // ƒêi·ªÅu khi·ªÉn b·∫±ng n√∫t b·∫•m
    document.getElementById("up").onclick = () => { userY -= 5; redraw(); };
    document.getElementById("down").onclick = () => { userY += 5; redraw(); };
    document.getElementById("left").onclick = () => { userX -= 5; redraw(); };
    document.getElementById("right").onclick = () => { userX += 5; redraw(); };
    document.getElementById("zoomIn").onclick = () => { userScale *= 1.1; redraw(); };
    document.getElementById("zoomOut").onclick = () => { userScale /= 1.1; redraw(); };

    // Download
    document.getElementById("download").addEventListener("click", () => {
      const link = document.createElement("a");
      link.download = "anh-ghep.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    });
  </script>
</body>
</html>
